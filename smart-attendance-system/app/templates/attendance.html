{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-camera"></i> Mark Attendance</h5>
            </div>
            <div class="card-body text-center">
                <div id="attendance-status" class="mb-4">
                    <p class="lead">Click the button below to mark your attendance</p>
                </div>
                
                <button id="mark-attendance-btn" class="btn btn-success btn-lg">
                    <i class="fas fa-camera"></i> Mark My Attendance
                </button>
                
                <div id="loading" class="mt-3" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Processing...</span>
                    </div>
                    <p class="mt-2">Processing face recognition...</p>
                </div>
                
                <div id="result" class="mt-4"></div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h6>How to Mark Attendance</h6>
            </div>
            <div class="card-body">
                <ol>
                    <li>Click "Mark My Attendance" button</li>
                    <li>Allow camera access when prompted</li>
                    <li>Position your face clearly in the camera frame</li>
                    <li>Press SPACE key when your face is properly positioned</li>
                    <li>Wait for the system to recognize you</li>
                    <li>Your attendance will be marked automatically</li>
                </ol>
                
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Note:</strong> You can only mark attendance once per day.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#mark-attendance-btn').click(function() {
        $('#loading').show();
        $('#result').empty();
        $(this).prop('disabled', true);
        
        $.ajax({
            url: '{{ url_for("mark_attendance") }}',
            type: 'GET',
            success: function(response) {
                $('#loading').hide();
                $('#mark-attendance-btn').prop('disabled', false);
                
                if (response.success) {
                    $('#result').html(
                        '<div class="alert alert-success">' +
                        '<i class="fas fa-check-circle"></i> ' + response.message +
                        '</div>'
                    );
                } else {
                    $('#result').html(
                        '<div class="alert alert-danger">' +
                        '<i class="fas fa-times-circle"></i> ' + response.message +
                        '</div>'
                    );
                }
            },
            error: function() {
                $('#loading').hide();
                $('#mark-attendance-btn').prop('disabled', false);
                $('#result').html(
                    '<div class="alert alert-danger">' +
                    '<i class="fas fa-times-circle"></i> Error processing request' +
                    '</div>'
                );
            }
        });
    });
});
</script>
{% endblock %}